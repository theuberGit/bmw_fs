
<head>
    <style>
        .reg .cont_bottom .reg_table td.file_area p {
            float: none;
            clear: both;
            padding-top: 10px
        }

            .reg .cont_bottom .reg_table td.file_area p input[type="text"] {
                width: 539px;
            }

        .reg h4 {
            margin-bottom: 10px
        }

        .file_area > div {
            height: 38px;
        }

        .file_area {
            counter-reset: cnt1;
        }

            .file_area.thumb:after {
                content: "* .jpg, .png 파일만 업로드 가능  * 사이즈:374*294";
            }

            .file_area.banner:after {
                content: "* .jpg, .png 파일만 업로드 가능  * 사이즈:1148*170";
            }

            .file_area:after {
                content: "* .jpg, .png 파일만 업로드 가능  * 사이즈:1148*736";
            }

        .file_src.on:after {
            content: "";
            color: #666;
        }

        .thum_nail {
            overflow: hidden;
        }
        /*.thum_nail:after{content:"사이즈 351 * 264"; display:inline-block; padding: 14px 0 0 5px}*/
        .reg .cont_bottom .reg_table .event_btn_area input[type="text"] {
            margin-bottom: 10px;
            width: 467px;
        }

        .evt_btn_button {
            display: inline-block;
            width: 35px;
            height: 36.5px;
            line-height: 35px;
            border: 1px solid #c8c8c8;
            text-align: center;
            cursor: pointer;
            margin-left: 7px;
            background-color: #bbbbbb;
            color: #282828;
            font-size: 25px;
        }
        #note {
            height: 100px;
        }
    </style>
</head>
<div id="content" class="reg">
    <div class="cont_top">
        <h3>태블릿 프로모션</h3>
    </div>
    <div class="cont_bottom">
        <form method="post" enctype="multipart/form-data">
            <table class="reg_table">
                <colgroup>
                    <col width="130px" />
                    <col width="*" />
                </colgroup>
                <tr>
                    <th>작성자</th>
                    <td>@ViewBag.item.regId</td>
                </tr>
                <tr>
                    <th>브랜드 *</th>
                    <td class="radio_area">
                        <label for="BRAND_B"><input type="radio" name="brand" id="brandB" value="B" checked> BMW</label>
                        <label for="BRAND_M"><input type="radio" name="brand" id="brandM" value="M"> MINI</label>
                    </td>
                </tr>
                <tr>
                    <th><label for="startDate">게시 기간</label></th>
                    <td><input type="text" name="startDate" id="startDate" readonly="readonly" value="@ViewBag.item.startDate" title="게시 시작일" /> ~ <input type="text" name="endDate" id="endDate" readonly="readonly" value="@ViewBag.item.endDate" title="게시 종료일" /></td>
                </tr>
                <tr>
                    <th><label for="">배포</label></th>
                    <td class="radio_area">
                        <label for="deployY"><input type="radio" name="deployYn" id="deployY" value="Y"> 배포</label>
                        <label for="deployN"><input type="radio" name="deployYn" id="deployN" value="N"> 미배포</label>
                    </td>
                </tr>
            </table>
            <table class="reg_table">
                <colgroup>
                    <col width="130px" />
                    <col width="*" />
                </colgroup>
                <tr>
                    <th><label for="tit">제목</label></th>
                    <td><input type="text" class="tit" name="title" id="tit" value="@ViewBag.item.title" title="국문 제목"></td>
                </tr>
                <tr class="add_img_area">
                    <th>썸네일 이미지</th>
                    <td class="file_area thumb">
                        @if (ViewBag.thumbList.Count != 0)
                        {
                            for (int i = 0, size = ViewBag.thumbList.Count; i < size; i++)
                            {
                                <div class="thum_nail">
                                    <span class="file_src">@ViewBag.thumbList[i].originalFilename</span>
                                    <input type="file" class="input_file" name="thumbNail" id="thumbNail">
                                    <label for="thumbNail" class="btn_file">파일찾기</label>
                                    <input type="hidden" name="thumbIdxs" value="@ViewBag.thumbList[i].fileIdx" />
                                </div>
                            }
                        }
                        else
                        {
                            <div class="thum_nail">
                                <span class="file_src"></span>
                                <input type="file" class="input_file" name="thumbNail" id="thumbNail">
                                <label for="thumbNail" class="btn_file">파일찾기</label>
                            </div>
                        }
                    </td>
                </tr>
                <tr class="add_img_area">
                    <th>띠 배너 이미지</th>
                    <td class="file_area thumb">
                        @if (ViewBag.bannerList.Count != 0)
                        {
                            for (int i = 0, size = ViewBag.bannerList.Count; i < size; i++)
                            {
                                <div class="thum_nail">
                                    <span class="file_src">@ViewBag.bannerList[i].originalFilename</span>
                                    <input type="file" class="input_file" name="bannerImg" id="bannerImg">
                                    <label for="bannerImg" class="btn_file">파일찾기</label>
                                    <input type="hidden" name="bannerIdxs" value="@ViewBag.bannerList[i].fileIdx" />
                                </div>
                            }
                        }
                        else
                        {
                            <div class="thum_nail">
                                <span class="file_src"></span>
                                <input type="file" class="input_file" name="bannerImg" id="bannerImg">
                                <label for="bannerImg" class="btn_file">파일찾기</label>
                            </div>
                        }
                    </td>
                </tr>
                <tr class="add_img_area kor">
                    <th>본문 이미지</th>
                    <td class="file_area">
                        @if (ViewBag.mainImgList.Count != 0)
                        {
                            for (int i = 0, size = ViewBag.mainImgList.Count; i < size; i++)
                            {
                                <div class="file_item">
                                    <span class="file_src">@ViewBag.mainImgList[i].originalFilename</span>
                                    <input type="file" class="input_file" name="mainImg" id="file@(i)">
                                    <label for="file@(i)" class="btn_file">파일찾기</label>
                                    @if (i == 0)
                                    {
                                        <button type="button" class="btn_add_file" id="btnAddFile">+</button>
                                    }
                                    else
                                    {
                                        <button type="button" class="btnDelete" data-name="mainIdxs" data-key="@ViewBag.mainImgList[i].fileIdx" onclick="deleteFile(this, 'N');">-</button>
                                    }
                                    <input type="hidden" name="mainIdxs" value="@ViewBag.mainImgList[i].fileIdx" />
                                </div>
                            }
                        }
                        else
                        {
                            <div>
                                <span class="file_src"></span>
                                <input type="file" class="input_file" name="mainImg" id="file0">
                                <label for="file0" class="btn_file">파일찾기</label>
                                <button type="button" class="btn_add_file" id="btnAddFile">+</button>
                            </div>
                        }
                    </td>
                </tr>
                <tr>
                    <th><label for="note">의무표시사항<br />(유의사항) </label></th>
                    <td><textarea name="note" id="note" title="의무표시사항">@ViewBag.item.note</textarea></td>
                </tr>
            </table>
            <input type="hidden" name="idx" value="@ViewBag.item.idx" />
        </form>
        <div class="btn_area">
            <a href="list" class="btn_defualt btn_list">목록</a>
            <a href="javascript:void(0);" class="btn_defualt btn_reg" onclick="modForm();">수정</a>
        </div>
    </div>
</div>
<script>
    lnbSet(".web_promotion_mgmt");

    $("#startDate").datepicker({
        dateFormat: "yy-mm-dd",
        changeMonth: true,
        changeYear: true,
        yearRange: 'c-14:c+10',
        monthNames: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
        monthNamesShort: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
        dayNames: ['일', '월', '화', '수', '목', '금', '토'],
        dayNamesShort: ['일', '월', '화', '수', '목', '금', '토'],
        dayNamesMin: ['일', '월', '화', '수', '목', '금', '토'],
        onClose: function (selectedDate) {
            $("#endDate").datepicker("option", "minDate", selectedDate);
        }
    });
    $("#endDate").datepicker({
        dateFormat: "yy-mm-dd",
        changeMonth: true,
        changeYear: true,
        yearRange: 'c-14:c+10',
        monthNames: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
        monthNamesShort: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
        dayNames: ['일', '월', '화', '수', '목', '금', '토'],
        dayNamesShort: ['일', '월', '화', '수', '목', '금', '토'],
        dayNamesMin: ['일', '월', '화', '수', '목', '금', '토'],
        onClose: function (selectedDate) {
            $("#startDate").datepicker("option", "maxDate", selectedDate);
        }
    });

     if ('@ViewBag.item.brand' === 'B') {
        $('#brandB').prop('checked', true);
    } else if ('@ViewBag.item.brand' === 'M') {
        $('#brandM').prop('checked', true);
    }

    if('@ViewBag.item.deployYn' === 'Y'){
        $('#deployY').prop('checked', true);
    }else{
        $('#deployN').prop('checked', true);
    }

    function modForm() {
        if (!validation()) return;
        if (!confirm('수정하시겠습니까?')) return;
        $('#content form').attr('action', 'modifyProc').submit();
    };

    function validation() {
        var mainImgFlag = false;

        if (!$('#startDate').required()) return;
        if (!$('#endDate').required()) return;
        if (!$('#tit').required()) return;
        if ($('#thumbNail').parent().find('.file_src').text() === '') {
            alert('썸네일을 등록하세요.');
            return;
        }
        if ($('#bannerImg').parent().find('.file_src').text() === '') {
            alert('띠 배너를 등록하세요.');
            return;
        }
        $('input[name=mainImg]').each(function () {
            if ($(this).parent().find('.file_src').text() === '') {
                mainImgFlagKor = true;
            }
        });
        if (mainImgFlag) {
            alert('본문 이미지를 등록하세요.');
            return;
        }

        if (!validationFileType('jpg, png')) return;

        if (!$('#note').required()) return;
        return true;
    };

    function deleteFile(obj, autoYn) {
        if (autoYn == 'N') {
            if (!confirm('파일을 삭제하시겠습니까?')) return;
        }
        $obj = $(obj);
        $fileKey = $obj.attr('data-key');
        $obj.parent("div").remove();
        if ($fileKey != '') {
            var html = '<input type="hidden" name="' + $obj.attr("data-name") + '" value="' + ($fileKey * -1) + '">';
            if ($obj.attr("data-name") == 'mainIdxs') {
                html += '<input type="file" style="display:none;" class="input_file" name="mainImg" />';
            } else {
                html += '<input type="file" style="display:none;" class="input_file" name="engMainImg" />';
            }
            $('#content form').append(html);
        }
    };

(function($){
	var $fileArea = $(".add_img_area").find('.file_area');

	$(".add_img_area").find(".file_area").on("change",".input_file",function(e){
		var $parent = $(this).closest("div");
		var val = $(this).val();
		var valTit = val.split("\\");
		var valTittext = valTit[valTit.length -1]
		if(val != ""){
			$parent.find(".file_src").text(valTittext).addClass("on");
		};
	});

	$(".add_img_area").each(function(index, item){
		//var cnt = 0;
        var cnt = $(item).find(".file_item").length;
        $(item).find(".btn_add_file").on("click", function () {
			if($(item).find( "input[type='file']" ).length < 10){
				cnt++;
                var html = '<div><span class="file_src"></span><input type="file" class="input_file" id="file' + cnt + '" name="mainImg" /><label for="file' + cnt + '" class="btn_file">파일찾기</label><button type="button" class="btnDelete" data-key="" onclick="deleteFile(this, \'N\');">-</button></div>';
				$(item).find(".file_area").append(html);
			};
		});
		//$fileArea.on("click" , ".btnDelete" ,deleteFile);
    });

    $("#note").keydown(function (key) {

        if (key.keyCode == 13) {//enter key block
            return false;
        }

    });

})(jQuery);
</script>
